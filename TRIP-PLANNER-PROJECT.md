# Trip Planner AI - Project Documentation

## Project Overview
An AI-powered trip planning feature integrated into the Geonauts Guide landmark application. Users can input their destination, dates, and interests, and receive a personalized day-by-day itinerary with real weather forecasts, packing suggestions, and landmark recommendations with audio tour integration.

**Live URL:** https://divinepilgrim.com (temporary - will be geonautsguide.com)  
**Frontend Repository:** https://github.com/djcastelino/landmarksguide.git  
**n8n Webhook:** https://workflowly.online/webhook/generate-trip

---

## Architecture

### Frontend (React)
- **Location:** `/Users/dcasteli/Documents/pda/landmarksguide`
- **Main Component:** `src/components/TripPlanner.jsx`
- **Integration Point:** `src/App.jsx` (toggle button for Trip Planner view)

### Backend (n8n Workflow)
- **Workflow Name:** Travel Itinerary Planner
- **Webhook Path:** `/webhook/generate-trip`
- **AI Model:** Llama 3.3 70B (via Groq API)
- **Weather API:** OpenWeatherMap
- **Key Feature:** Hybrid weather logic (real forecast for 1-5 days, historical averages for 6+ days)

---

## Key Features

### 1. User Input Form
- Destination (text input)
- Start/End dates (date pickers)
- Interests selection (8 categories: Culture, Food, Adventure, Beach, Shopping, Nightlife, Nature, Art)

### 2. AI-Generated Itinerary
- Day-by-day breakdown with Morning/Afternoon/Evening activities
- Each activity includes:
  - Location name
  - Duration estimate
  - Practical tip
  - Google Maps link
  - Audio tour badge (if landmark)

### 3. Weather Intelligence
- **Days 1-5:** Real 5-day forecast from OpenWeatherMap
- **Days 6+:** Historical seasonal averages by month
- Temperature display rounded to nearest degree
- Weather advice in the trip overview

### 4. Landmark Integration
- Frontend sends full landmarks array to n8n
- n8n filters relevant landmarks by city/country match
- AI includes landmarks in itinerary when available
- Activities marked with `hasAudioTour: true` badge

### 5. Packing Suggestions
- Weather-appropriate items
- Generated by AI based on season and destination

---

## File Structure

```
/Users/dcasteli/Documents/pda/landmarksguide/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ TripPlanner.jsx          # Main Trip Planner component (327 lines)
â”‚   â”œâ”€â”€ App.jsx                       # Added Trip Planner toggle button
â”‚   â””â”€â”€ data/
â”‚       â””â”€â”€ landmarks.json            # Landmark database with audio tours
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

---

## n8n Workflow Structure

### Nodes (in execution order):

1. **Travel Planner Webhook**
   - Path: `generate-trip`
   - Method: POST
   - Receives: `{destination, startDate, endDate, interests, landmarks}`

2. **Calculate Trip Details** (Code Node)
   - Calculates trip duration
   - Filters relevant landmarks by destination
   - Creates `landmarksList` string for AI prompt

3. **Generate Itinerary** (HTTP Request to Groq)
   - Calls Llama 3.3 70B model
   - Receives detailed prompt with destination, dates, interests, landmarks
   - Returns JSON with `morning/afternoon/evening` structure

4. **Get Weather Forecast** (HTTP Request to OpenWeatherMap)
   - Fetches 5-day forecast
   - 40 data points (every 3 hours)

5. **Parse Daily Weather** (Code Node)
   - Determines if trip is near (forecast available) or far (use historical)
   - Extracts midday temps (12-15h) from forecast
   - Generates historical averages by month for days beyond forecast
   - Returns `weather` object with per-day temps

6. **Add Google Maps Links** (Code Node)
   - Parses Groq JSON response
   - Adds `mapUrl` to each morning/afternoon/evening activity

7. **Merge** (Merge Node)
   - Combines itinerary data + weather data

8. **Combine All Data** (Code Node)
   - Merges weather into itinerary days
   - Creates final response structure

9. **Convert to Frontend Format** (Code Node)
   - Transforms `morning/afternoon/evening` â†’ `activities[]` array
   - Each activity gets: `time, emoji, name, location, duration, tip, hasAudioTour, mapLink`
   - Returns structure matching frontend expectations

10. **Send Itinerary** (Respond to Webhook)
    - Returns final JSON to frontend

---

## Response Format

### Frontend Expects:
```json
{
  "destination": "Paris, France",
  "description": "2-3 sentence overview",
  "days": 5,
  "weather": {
    "advice": "December is winter season with cold temperatures...",
    "temperature": "4-8Â°C"
  },
  "packing": ["warm coat", "umbrella", "comfortable shoes", "scarf"],
  "itinerary": [
    {
      "day": 1,
      "title": "Iconic Landmarks",
      "date": "2026-02-15",
      "weather": "6Â°C",
      "activities": [
        {
          "time": "Morning",
          "emoji": "ðŸŒ…",
          "name": "Eiffel Tower",
          "location": "Champ de Mars, Paris",
          "duration": "2-3 hours",
          "tip": "Book tickets online to skip lines",
          "hasAudioTour": false,
          "mapLink": "https://www.google.com/maps/search/..."
        }
      ]
    }
  ]
}
```

---

## Weather Logic Deep Dive

### Parse Daily Weather Node Code:
```javascript
// Key logic:
const today = new Date();
const daysUntilTrip = Math.ceil((startDate - today) / (1000 * 60 * 60 * 24));

// Extract forecast data
const forecastByDate = {};
weatherInput.list.forEach(item => {
  const date = item.dt_txt.split(' ')[0];
  const hour = parseInt(item.dt_txt.split(' ')[1].split(':')[0]);
  
  // Take midday temps (12-15h)
  if (hour >= 12 && hour <= 15) {
    forecastByDate[date] = {
      temp: Math.round(item.main.temp),
      description: item.weather[0].description
    };
  }
});

// For each trip day:
for (let i = 0; i < tripDays; i++) {
  const dayDate = new Date(startDate);
  dayDate.setDate(dayDate.getDate() + i);
  const dateStr = dayDate.toISOString().split('T')[0];
  
  if (forecastByDate[dateStr]) {
    // Use real forecast
    dailyWeather[i + 1] = {
      temp: forecastByDate[dateStr].temp,
      isHistorical: false
    };
  } else {
    // Use historical averages by month
    dailyWeather[i + 1] = {
      temp: 6,  // Example for winter
      tempRange: '4-8Â°C',
      isHistorical: true
    };
  }
}
```

---

## Frontend Integration

### TripPlanner.jsx Key Functions:

```javascript
const handleGenerateTrip = async () => {
  setIsGenerating(true);
  setTripView('generating');

  const response = await fetch('https://workflowly.online/webhook/generate-trip', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      destination,
      startDate,
      endDate,
      interests: selectedInterests,
      landmarks  // Full landmarks array from props
    })
  });

  const data = await response.json();
  setTripData(data);
  setTripView('itinerary');
};
```

### Three View States:
1. **form** - Initial input form
2. **generating** - Loading animation with spinning icon
3. **itinerary** - Full day-by-day display with weather, maps, packing

---

## Deployment Process

### Frontend Deployment:
```bash
cd /Users/dcasteli/Documents/pda/landmarksguide
npm run build
git add .
git commit -m "Update trip planner"
git push origin main
```

Changes auto-deploy to: https://divinepilgrim.com

### n8n Workflow:
- Changes are made directly in n8n UI at workflowly.online
- Workflow must be **activated** to be live
- Only one workflow can use the `/webhook/generate-trip` path

---

## Current Status

### âœ… Completed:
- Trip Planner UI fully functional
- n8n workflow integrated with Llama 3.3
- Real weather forecast for near dates (1-5 days)
- Historical weather averages for far dates (6+ days)
- Landmark integration with audio tour badges
- Google Maps links for all activities
- Packing suggestions
- Deployed to production at divinepilgrim.com (Geonauts Guide)

### ðŸ”„ Pending:
- Additional testing with various destinations
- Testing different trip lengths (1-day, 10-day+)
- Verify landmark matching accuracy
- Mobile responsiveness polish

---

## Known Issues & Solutions

### Issue: Weather showing same temp for all days
**Solution:** Updated "Parse Daily Weather" to use real forecast for days 1-5, historical for 6+

### Issue: Frontend expecting `activities[]` but AI returns `morning/afternoon/evening`
**Solution:** Added "Convert to Frontend Format" node to transform structure

### Issue: Webhook path conflict
**Solution:** Deactivate old "Trip Planner AI Generator" workflow, keep "Travel Itinerary Planner" active

---

## API Keys & Credentials

### Groq API (Llama 3.3):
- Used in "Generate Itinerary" HTTP Request node
- Header: `Authorization: Bearer [YOUR_GROQ_API_KEY]`

### OpenWeatherMap:
- Used in "Get Weather Forecast" HTTP Request node
- API Key: `[YOUR_OPENWEATHER_API_KEY]`
- Query param: `appid`

---

## Testing Checklist

- [ ] Near-date trip (1-5 days out) - verify real forecast
- [ ] Far-date trip (30+ days out) - verify historical averages
- [ ] Short trip (1-2 days) - verify correct day count
- [ ] Long trip (8-10 days) - verify mixed forecast/historical
- [ ] Landmark-rich destination (Rome, Paris) - verify audio tour badges
- [ ] Non-landmark destination (random city) - verify graceful handling
- [ ] Mobile display - verify responsive design
- [ ] Map links - verify they open correct locations

---

## Future Enhancements

1. **Save/Share Trip** - Implement backend storage for saved itineraries
2. **PDF Export** - Generate downloadable PDF of itinerary
3. **Currency Conversion** - Show estimated costs in user's currency
4. **Accommodation Suggestions** - Integrate hotel recommendations
5. **Multi-Destination** - Support multi-city trips
6. **Calendar Integration** - Export to Google Calendar/iCal
7. **User Accounts** - Save trip history and preferences
8. **Collaborative Planning** - Share and edit trips with friends

---

## Development Notes

### TravelCraft Workflow Origin:
This n8n workflow is based on a standalone TravelCraft application the user built previously. We imported the working workflow because it had proven weather logic that correctly handled near/far dates. We then adapted it to:
- Accept landmarks array from frontend
- Convert output format from morning/afternoon/evening to activities array
- Integrate with Geonauts Guide's landmark database

### Why We Switched:
The initial attempt to build the workflow from scratch had issues with weather display (showing current temp for all days regardless of date). Rather than continue debugging, we used the user's proven TravelCraft workflow as the foundation and made minimal adaptations.

---

## Git Repository Info

**Frontend Repo:** https://github.com/djcastelino/landmarksguide.git  
**Latest Commit:** b6df160 (Trip Planner integration complete)  
**Branch:** main  
**Local Path:** /Users/dcasteli/Documents/pda/landmarksguide

---

## Contact & Handoff

This project was developed through multiple sessions. The Trip Planner is now fully functional on production. For continuation or debugging, refer to this document and the code files listed above.

**Last Updated:** January 14, 2026  
**Status:** âœ… Production Ready - Pending Additional Testing
